#!/usr/bin/env python2
from pwn import *
import hashpumpy
from urlparse import parse_qsl
r = remote('cpushop.2018.teamrois.cn', 43000)
print r.recvuntil("Command:")
r.send("2")
print r.recvuntil("Product ID:")
r.send("1")
print r.recvuntil("Your order:")
order = r.recvuntil("Money").splitlines()[1]
sign = parse_qsl(order)[3][1]
order = order[:order.rfind('&sign=')]
for i in xrange(8,32):
	response = r.recvuntil("Command:")
	print response
	if "flag" in response:
		break
	r.send("3")
	print r.recvuntil("Your order:")
	new_hash,new_order = hashpumpy.hashpump(sign,order,"&product=Flag",i)
	r.send(new_order+"&sign="+new_hash)
r.interactive()