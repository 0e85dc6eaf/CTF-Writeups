# cereal hacker 1

First we have to guess `guest:guest` credentials (the most difficult part of the challenge).

Once we login we get `user_info` cookie.

```
TzoxMToicGVybWlzc2lvbnMiOjI6e3M6ODoidXNlcm5hbWUiO3M6NToiZ3Vlc3QiO3M6ODoicGFzc3dvcmQiO3M6NToiZ3Vlc3QiO30%253D
```

Decoded (double urldecode + base64 decode):

```
O:11:"permissions":2:{s:8:"username";s:5:"guest";s:8:"password";s:5:"guest";}
```

We can see that it's serialized PHP object. Since the cookie isn't signed we can easily modify its contents.

We don't know admin's password, but the site is vulnerable to SQL injection attack (please note that login page isn't vulnerable).

[script to forge cookie](forge_cookie.php)

Flag: `picoCTF{2eb6a9439bfa7cb1fc489b237de59dbf}`

# cereal hacker 2

Thanks to LFI vulnerability we can leak source code of this challenge. (`file` parameter is vulnerable)

We can use `php://` urls with rot13 encoder to read PHP files (if we don't encode the files, they will be interpreted as PHP code).

* admin.php: [decoded](source_code/admin.php), [link](http://2019shell1.picoctf.com:62195/index.php?file=php://filter/read=string.rot13/resource=admin)
* cookie.php: [decoded](source_code/cookie.php), [link](http://2019shell1.picoctf.com:62195/index.php?file=php://filter/read=string.rot13/resource=cookie)
* index.php: [decoded](source_code/index.php), [link](http://2019shell1.picoctf.com:62195/index.php?file=php://filter/read=string.rot13/resource=index)
* login.php: [decoded](source_code/login.php), [link](http://2019shell1.picoctf.com:62195/index.php?file=php://filter/read=string.rot13/resource=login)
* regular_user.php: [decoded](source_code/regular_user.php), [link](http://2019shell1.picoctf.com:62195/index.php?file=php://filter/read=string.rot13/resource=regular_user)
* sql_connect.php: [decoded](source_code/sql_connect.php), [link](http://2019shell1.picoctf.com:62195/index.php?file=php://filter/read=string.rot13/resource=../sql_connect)

As we can see in `cookie.php` file, `permissions` class uses prepared statements now, so SQL injection is no longer possible. However right below it there is `siteuser` class that contains "legacy login" (simply previous, vulnerable version). We can use it to attack the application again.

Unfortunately this time we get the following message:
```
Flag: Find the admin's password!
```

We have to perform blind SQL injection attack to retrieve admin's password.

[exploit](exploit.php)

Flag: `picoCTF{c9f6ad462c6bb64a53c6e7a6452a6eb7}`