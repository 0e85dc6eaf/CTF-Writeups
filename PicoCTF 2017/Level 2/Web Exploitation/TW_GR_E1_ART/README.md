# TW_GR_E1_ART

> Oh, sweet, they made a spinoff game to Toaster Wars! That last room has a lot of flags in it though. I wonder which is the right one...? Check it out here.

Hints:

> I think this game is running on a Node.js server. If it's configured poorly, you may be able to access the server's source. If my memory serves me correctly, Node servers have a special file that lists dependencies and a start command; maybe you can use that file to figure out where the other files are?

**Important note! If you see black window in left top corner, but the websites works it means that the DB is offline and you can try to contact admin on piazza.**

Node.js stores dependencies in package.json file and there we can also obtain the location of server files.
When we search for flag word in included files we can find the following code:
```
// http://shell2017.picoctf.com:55830/server/game.js
case "revealFlag":
	if (entity.items[action.item].effects[i].check == 64) {
		outcome.flag = process.env["PICO_CTF_FLAG"];
	}
```

```
//http://shell2017.picoctf.com:55830/server/config.js
function createFlag(check, location) {
	return {
		name: "Flag",
		description: "Gives you the flag... maybe.",
		location: location,
		use: 0,
		id: check + 100,
		sprite: "flag",
		effects: [
			{
				type: "revealFlag",
				check: check
			},
			{
				type: "destroyItems"
			}
		]
	};
}

...

items: Array.from(new Array(83), (_, idx) => {
	if (idx >= 2) {
		idx++
	}

	if (idx >= 77) {
		idx++;
	}

	var r = Math.floor(idx / 5) + 1;
	var c = (idx % 5) + 1;

	return createFlag(idx, { r: r, c: c });
}),
```

From the sources we can see that ID of the correct flag would be 164. We can check objects info when we type
`state.items` in JS console in the browser. To make it even easier we can calculate the location of the flag.
We see that 64th flag is the one which interests us the most, so idx will be equal 64.

`var r = Math.floor(64 / 5) + 1; // r=13`

`var c = (64 % 5) + 1; //c=5`

So the flag will be in 13th row and 5th column. So let's collect that flag. You can check if you have the correct one typing
`state.player.items` in console and compare the id to 164. Use the right flag and read the message in right top window.

The flag is `at_least_the_world_wasnt_destroyed_by_a_meteor_842aea1de69aa7c4069e8aae8815d22b`.
