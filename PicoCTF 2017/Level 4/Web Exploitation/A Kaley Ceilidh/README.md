# A Kaley Ceilidh

> Everyone loves Scottish food [citation needed], but do you ever wish there were more hipster-y options? Well look no further than a Kaley Ceilidh.

Hints:

> There's not a whole lot you can do on this application. If your normal attacks aren't working, perhaps you need to think bigger. Humongous, in fact.

> The server probably won't show you anything that contains a "flag" property.

This time we got a website written in JavaScript (X-Powered-By header) and if we use search functionality we can see that it sends JSON object.
We can assume that the application uses some NoSQL database. When we send 
```json
{"name":{"$ne":"1"}}
```
in POST body we get "Error", but 
```json
{"$where":"return true;"}
```
works fine and we get back everything from database. Unfortunately there is no flag there.
Second hint is very useful. Thanks to it we know that there is some record that has flag property and this one won't be returned (but it exists).
This also means that we have to attack server blindly. According to the [MongoDB documentation](https://docs.mongodb.com/manual/reference/method/sleep/) there is sleep() function and the server sends us how much time it took to execute query.
First let's find out what is the length of our flag.
```json
{"$where":"if(this.flag)sleep(this.flag.length * 20);return false;"}
```
Response:
```json
{"data":[],"time":623}
```
623 is really close to 620, so it seems that the flag has 31 characters. [Final script](solve.php)
```
$ php solve.php
(31 lines of output)
The flag is: flag{I_only_eat_0rg4n1c_flages}
```

The flag is `flag{I_only_eat_0rg4n1c_flages}`.
